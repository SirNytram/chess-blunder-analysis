<html>
  <head>
    <title>Chess Blunder Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  </head>
  <body>
    <div>
      <h1>Chess Blunder Analysis</h1>
      <form method="POST">
        <textarea name="pgn" rows="6" cols="60">{{pgn}}</textarea><br>
        <input type="checkbox" name="detailed">Detailed<br>
        <input type="text" name="think_time" value="{{think_time}}"><br>
        <input type="submit">
      </form>
    </div>  

    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script>
      const labels = [
      {% for move in moves %}
        '{{move['move_no']}}',
        {% endfor %}
      ];
    
      const data = {
        labels: labels,
        datasets: [
        {
          label: 'Score',
          backgroundColor: 'rgb(255, 99, 132)',
          borderColor: 'rgb(255, 99, 132)',
          data: [ {% for move in moves %}{{move['score_graph']}},{% endfor %} ],
        },
        {
          label: 'Mid Line',
          borderColor: "#3e95cd",
          data: [ {% for move in moves %}0,{% endfor %} ],
        }
      ]
      };
    
      const config = {
        type: 'line',
        data: data,
        options: {}
      };
    </script>

    <script>
      const myChart = new Chart(
        document.getElementById('myChart'),
        config
      );
    </script> 





   
    <div>
      <table border=1 style="border-collapse:collapse">
        <thead>
          <th>move no</th>
          <th>score</th>
          <th>move</th>
          <th>score diff</th>
          <th></th>
          <th>comment</th>
        </thead>
        {% for move in moves %}
        <tr>
          <td>{{move['move_no']}}</td>
          <td>{{move['score']}}</td>
          <td>{{move['move']}}</td>
          {% for top_move in move['top_moves'] %}
          <td>{{top_move['move']}} {{top_move['score']}}</td>
          {% endfor %}
          <td>{{move['score_diff']}}</td>
          <td></td>
          <td>{{move['comment']}}</td>
        </tr>
        {% endfor %}

      </table>
      Render Time: {{time}} ms
    </div>
  </body>
</html>
